<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Eagle Smash</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rye&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #1a1a2e;
      font-family: system-ui, sans-serif;
    }
    .wrapper {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    #canvas {
      display: block;
      background: linear-gradient(180deg, #87CEEB 0%, #B0E0E6 50%, #98D8E8 100%);
    }
    #status {
      position: absolute;
      top: 12px;
      left: 12px;
      font-family: sans-serif;
      font-weight: bold;
      font-size: 14px;
      color: #333;
      text-shadow: 0 0 4px rgba(255,255,255,0.9);
      pointer-events: none;
      z-index: 10;
    }
    #title-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.2em;
      background: transparent;
      z-index: 20;
      padding: 15%;
      cursor: pointer;
      pointer-events: auto;
    }
    #title-overlay.hidden {
      display: none;
    }
    #title-overlay .title-text {
      font-family: 'Rye', serif;
      font-weight: 400;
      text-align: center;
      line-height: 1.35;
      letter-spacing: 0.02em;
      opacity: 0.22;
      color: #8B2500;
      text-shadow: 0 0 40px rgba(245, 222, 179, 0.4);
      font-size: clamp(2rem, 8vw, 5rem);
      width: 92%;
      max-width: 92%;
      margin: 0 auto;
    }
    #title-overlay .subtitle-text {
      font-family: 'Rye', serif;
      font-size: 0.35em;
      letter-spacing: 0.03em;
      opacity: 0.2;
      color: #B8860B;
      text-align: center;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
</head>
<body>
  <div class="wrapper" style="position: relative; width: 900px; height: 500px; margin: 0 auto;">
    <div id="title-overlay" title="Click anywhere to begin" style="position: absolute; inset: 0; width: 900px; height: 500px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0.2em; background: transparent; z-index: 20; padding: 0; cursor: pointer; pointer-events: auto;">
      <div class="title-text" style="font-size: 3rem; width: 85%; max-width: 85%;">Welcome to Mr. Oxford's Digital Media Class.</div>
      <div class="subtitle-text" style="font-family: 'Rye', serif; font-size: 1.2rem; width: 85%; max-width: 85%; margin: 0 auto; text-align: center;">Click Here to Begin</div>
    </div>
    <div id="status" style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); z-index: 21;">Initializing...</div>
    <canvas id="canvas" width="900" height="500" style="display: block; background: #fff; z-index: 10; position: relative;"></canvas>
  </div>
  <script>
    document.getElementById('title-overlay').addEventListener('click', function(e) {
      e.preventDefault();
      window.open('https://oxford-class-site.pages.dev/', '_blank', 'noopener,noreferrer');
      this.classList.add('hidden');
    });
  </script>

  <script>
    (function() {
      // Sprite paths and scale (images show when hosted; locally we draw red/tan shapes)
      const EAGLE_SRC = 'OPA Mascot Head Large Banner Removed.png';
      const TARGET_SRC = 'IMG_5532.png';
      const EAGLE_SCALE = 0.15;
      const TARGET_SCALE = 0.2;
      const RESET_DELAY_MS = 4000;
      const LAUNCH_DELAY_MS = 1500;

      const W = 900;
      const H = 500;
      const BORDER_THICKNESS = 6;

      const Engine = Matter.Engine;
      const Render = Matter.Render;
      const Runner = Matter.Runner;
      const Bodies = Matter.Bodies;
      const Body = Matter.Body;
      const Composite = Matter.Composite;
      const Events = Matter.Events;
      const World = Matter.World;

      let eagleImg = null;
      let targetImg = null;
      let eagleImgOk = false;
      let targetImgOk = false;
      let eagleBody = null;
      let resetTimeoutId = null;

      function setStatus(msg) {
        const el = document.getElementById('status');
        if (el) el.textContent = msg;
      }

      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');

      const engine = Engine.create({ gravity: { x: 0, y: 1 } });
      const world = engine.world;

      const render = Render.create({
        canvas: canvas,
        context: ctx,
        engine: engine,
        options: {
          width: W,
          height: H,
          wireframes: false,
          background: 'transparent'
        }
      });

      Runner.create();
      Engine.run(engine);
      Render.run(render);

      function drawWorldBorder() {
        ctx.save();
        ctx.strokeStyle = '#333';
        ctx.lineWidth = BORDER_THICKNESS;
        ctx.strokeRect(BORDER_THICKNESS / 2, BORDER_THICKNESS / 2, W - BORDER_THICKNESS, H - BORDER_THICKNESS);
        ctx.restore();
      }

      function drawSky() {
        const g = ctx.createLinearGradient(0, 0, 0, H);
        g.addColorStop(0, '#87CEEB');
        g.addColorStop(0.5, '#B0E0E6');
        g.addColorStop(1, '#98D8E8');
        ctx.fillStyle = g;
        ctx.fillRect(0, 0, W, H);
      }

      function drawBody(body, img, wPx, hPx, fallbackColor) {
        const pos = body.position;
        const angle = body.angle;
        ctx.save();
        ctx.translate(pos.x, pos.y);
        ctx.rotate(angle);
        if (img && img.complete && img.naturalWidth) {
          ctx.drawImage(img, -wPx / 2, -hPx / 2, wPx, hPx);
        } else {
          ctx.fillStyle = fallbackColor;
          if (body.circleRadius) {
            ctx.beginPath();
            ctx.arc(0, 0, body.circleRadius, 0, Math.PI * 2);
            ctx.fill();
          } else {
            ctx.fillRect(-wPx / 2, -hPx / 2, wPx, hPx);
          }
        }
        ctx.restore();
      }

      const EAGLE_DISPLAY = 132;
      const TARGET_DISPLAY = 90;

      function customDraw() {
        drawSky();
        const bodies = Composite.allBodies(world);
        for (const b of bodies) {
          if (b.render && b.render.visible === false) {
            if (b.label === 'eagle') {
              drawBody(b, eagleImg, EAGLE_DISPLAY, EAGLE_DISPLAY, '#c00');
            } else if (b.label === 'target') {
              drawBody(b, targetImg, TARGET_DISPLAY, TARGET_DISPLAY, '#c4a574');
            }
          }
        }
        drawWorldBorder();
      }
      Events.on(render, 'afterRender', customDraw);

      function createGround() {
        const ground = Bodies.rectangle(W / 2, H + 35, W + 100, 70, {
          isStatic: true,
          render: { visible: false }
        });
        World.add(world, ground);
      }

      function createEagle() {
        const radius = EAGLE_DISPLAY / 2;
        eagleBody = Bodies.circle(100, H - 180, radius, {
          restitution: 0.3,
          friction: 0.2,
          density: 0.008,
          render: { visible: false, fillStyle: '#c00' }
        });
        eagleBody.label = 'eagle';
        World.add(world, eagleBody);
      }

      function createTargetStack() {
        const baseX = W - 260;
        const baseY = H - 80;
        const boxW = TARGET_DISPLAY;
        const boxH = TARGET_DISPLAY;
        const rows = 4;
        for (let row = 0; row < rows; row++) {
          const count = rows - row;
          const rowY = baseY - row * (boxH + 2);
          const totalWidth = (count - 1) * (boxW + 2);
          const startX = baseX - totalWidth / 2 + (boxW + 2) / 2;
          for (let i = 0; i < count; i++) {
            const x = startX + i * (boxW + 2);
            const b = Bodies.rectangle(x, rowY, boxW, boxH, {
              restitution: 0.55,
              friction: 0.35,
              density: 0.0008,
              render: { visible: false, fillStyle: '#c4a574' }
            });
            b.label = 'target';
            World.add(world, b);
          }
        }
      }

      function launchEagle() {
        if (!eagleBody) return;
        const force = {
          x: 7.5 + Math.random() * 4,
          y: -(4 + Math.random() * 2)
        };
        Body.applyForce(eagleBody, eagleBody.position, force);
        setStatus('Impact!');
      }

      function initGame() {
        if (resetTimeoutId) {
          clearTimeout(resetTimeoutId);
          resetTimeoutId = null;
        }
        World.clear(world);
        eagleBody = null;

        setStatus('Launching in 2s...');
        createGround();
        createEagle();
        createTargetStack();

        setTimeout(function() {
          launchEagle();
          resetTimeoutId = setTimeout(function() {
            setStatus('Resetting...');
            initGame();
          }, RESET_DELAY_MS);
        }, LAUNCH_DELAY_MS);
      }

      function loadImages(callback) {
        eagleImg = new Image();
        eagleImg.onload = function() {
          eagleImgOk = true;
          tryFinish();
        };
        eagleImg.onerror = function() { eagleImgOk = false; tryFinish(); };
        eagleImg.src = EAGLE_SRC;

        targetImg = new Image();
        targetImg.onload = function() {
          targetImgOk = true;
          tryFinish();
        };
        targetImg.onerror = function() { targetImgOk = false; tryFinish(); };
        targetImg.src = TARGET_SRC;

        let done = 0;
        function tryFinish() {
          done++;
          if (done === 2) callback();
        }
      }

      loadImages(function() {
        setStatus('Ready. Launching in 2s...');
        initGame();
      });
    })();
  </script>
</body>
</html>
